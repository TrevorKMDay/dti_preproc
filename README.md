# dti_preproc

This project is a collection of scripts and utilities aimed at simplifing the automation of DTI preprocessing.

The main features of this package are:
- Automatic generation of QA reports as standalone .html files
- Itegrated motion correction and EPI unwarping
  (both fieldmap-based unwarping and “blip-up, blip-down” unwarping)
- Support for processing pipelines based on GNU make

These scripts are intended implement ‘state of the art’ preprocessing options by default. This includes motion correction with fsl’s ‘eddy’, with rotation of the b-vectors, and tensor estimation using RESTORE.

The main script is dti_preproc.sh

...

PREPARING THE DATA:

   This script assumes all b0s and dwi are concatenated into one 4d image, with the b0's first
concatenate_diffusion.sh and rearrange_diffusion.sh have been 

MAKE-BASED PIPELINE:

   These scripts can be integrated into a processing pipeline based on ‘GNU Make’, using the approach described in [Askren et al 2016 - doi: 10.3389/fninf.2016.00002]. ‘example_makefile.mk’ can serve as a template, but will need to your particular environment.

EXPLANATION OF FILES:

==main scripts==

dti_preproc.sh 				: the main script, calls the other scripts in the appropriate order
unwarp_bupbdown.sh 			: unwarps EPI distortions using images acquired with the phase-encoding 
                              along opposite direction (i.e. “blip-up, blip-down” images)
motion_correct.sh 			: corrects for motion and eddy currents using fsl’s ‘eddy’
unwarp_fieldmap.sh 			: unwarps EPI distortions using an acquired fieldmap
fit_tensor.sh 				: fits the diffusion tensor (defaut: RESTORE as implemented in Camino)

==report generation==

unwarp_bupbdown_report.sh  
motion_correct_report.sh   
unwarp_fieldmap_report.sh  
fit_tensor_report.sh       


==utilites for preparing the data==

concatenate_diffusion.sh 	: combines two runs of diffusion data, including 4d images, b-values and b-vectors.
rearrange_diffusion.sh 		: rearranges a diffusion run (incl. 4d images, bvals, bvecs)   


==utilities that are called by other scripts==

eddy_pars_to_xfm_dir.py 	: takes a ‘motion parameter file’ as generated by eddy and make a 
                              directory of linear transforms
image_to_movie.sh 			: takes a 4d image and creates an animated gif showing 
							  tri-planar images across various slices

==other resources==

b02b0_fast.cnf 				: configuration file for topup that does a minimal amount of processing. 
                              used for debugging/testing in “fast mode”
example_makefile.mk 		: An example makefile for gnu-make based processing



DEPENDENCIES:

whirlgif

fsl

camino

R (with rmarkdown)

pandoc


TO DO:

-Sense number of S0 images in makefile

-Correct min/max display in output images

-Add to report:

--Log command that was called

--Log versions of fsl, camino, etc

--Display image of bvecs

--Display fieldmap

--Display image-wise residuals
